define(["API/Register"],()=>({viewModel:function(){const RegisterAPI=require("API/Register"),Store=require("Store/Store");this.phoneNumber=this._request.phoneNumber;let itv,isEnableButton=!1;this.parsePhoneNumber=this.phoneNumber.replace(/^\+84/,"0"),this.showSendAgain=ko.observable(!1),this.backPage=(()=>{itv&&clearInterval(itv),app.backTo()}),this.afterBinding=(()=>{$(".mm-number-input-item > input").on("input",function(event){if((this.value.length>1||"e"===event.originalEvent.data)&&event.originalEvent.data&&(this.value=event.originalEvent.data),event.originalEvent.data&&"e"!==event.originalEvent.data){let nextElement=this.parentNode.nextElementSibling;nextElement&&nextElement.querySelector("input").focus()}getCode().length>=6?($(".btn-continue").css({"background-color":"#003780",color:"white"}),isEnableButton=!0):($(".btn-continue").css({"background-color":"#fff",color:"#000"}),isEnableButton=!1)}),initCounter()});let initCounter=()=>{let counter=30;itv=setInterval(()=>{document.getElementById("counter").innerHTML=--counter,0===counter&&(clearInterval(itv),this.showSendAgain(!0))},1e3)};this.sendAgain=(()=>{Store.isShowLoading(!0),RegisterAPI.getPhoneCode(this.phoneNumber).then(res=>{Store.isShowLoading(!1),0==res.code&&(initCounter(),this.showSendAgain(!1))}).catch(e=>{Store.isShowLoading(!1),console.log(e)})});let getCode=()=>{let code="";return $(".mm-number-input-item > input").each(function(index,e){code+=e.value}),code.trim()};this.confirm=(()=>{if(isEnableButton){clearInterval(itv);let code=getCode();Store.isShowLoading(!0),RegisterAPI.phoneLogin(this.phoneNumber,code).then(res=>{0==res.code&&(Store.isShowLoading(!1),localStorage.setItem("appToken",res.data),app.setPage("Home"))}).catch(e=>{Store.isShowLoading(!1),console.log(e)})}})},template:'\n            <div class="login-page">\n    <div class="back-btn" data-bind="event: {tap: backPage}">\n        <i class="far fa-chevron-left"></i>\n    </div>\n    <div class="header-bg">\n        <img src="./img/header_bg.svg">\n    </div>\n    <div class="title" style="padding-bottom: 30px;">\n        <div class="img-wrapper">\n            <img src="./img/logo.png">\n        </div>\n        HD System\n    </div>\n    <div class="sign-in-wrapper">\n        <div class="w-80" style="margin-bottom: 35px;">\n            <div class="status">Đã gởi mã đến <span data-bind="text: parsePhoneNumber"></span></div>\n            <div class="phone-number" style="text-align: center;">Nhập mã bảo mật</div>\n            <div class="mm-number">\n                <div class="mm-number-container">\n                    <div class="mm-number-input">\n                        <div class="mm-number-input-container animated">\n                            <div class="mm-number-input-item">\n                                <input type="number" class="animated" min="0" max="9">\n                            </div>\n                            <div class="mm-number-input-item">\n                                <input type="number" class="animated" min="0" max="9">\n                            </div>\n                            <div class="mm-number-input-item">\n                                <input type="number" class="animated" min="0" max="9">\n                            </div>\n                            <div class="mm-number-input-item">\n                                <input type="number" class="animated" min="0" max="9">\n                            </div>\n                            <div class="mm-number-input-item">\n                                <input type="number" class="animated" min="0" max="9">\n                            </div>\n                            <div class="mm-number-input-item">\n                                <input type="number" class="animated" min="0" max="9">\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="w-80">\n            <button class="btn-continue" data-bind="event: {tap: confirm}">Xác nhận</button>\n        </div>\n        <div class="w-80">\n            <div>Bạn không nhận được mã ?\n                <span id="sendCodeAgain" data-bind="hidden: showSendAgain">\n                    Gởi lại sau <span id="counter">30</span>\n                </span>\n                <span data-bind="event: {tap: sendAgain}, visible: showSendAgain"\n                    style="color: green; text-decoration: underline">Gởi\n                    lại</span>\n            </div>\n        </div>\n    </div>\n</div>\n        '}));