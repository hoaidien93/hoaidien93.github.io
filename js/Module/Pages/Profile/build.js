define(["API/UserAPI"],()=>({viewModel:function(){const store=require("Store/Store"),userAPI=require("API/UserAPI");this.avatar=localStorage.getItem("imageURL"),this.name=localStorage.getItem("name"),this.location=localStorage.getItem("address"),this.email=localStorage.getItem("email")||"Chưa cập nhật";let dateJoin=new Date(+localStorage.getItem("created_at"));this.phone=localStorage.getItem("phone")||"Chưa cập nhật",this.dateJoin=`Đã tham gia Tháng ${dateJoin.getMonth()} năm ${dateJoin.getFullYear()}`;let isChangeImage=!1,updateInfo={};this.update=(()=>{if(isChangeImage)if(store.isShowLoading(!0),0===Object.keys(updateInfo).length){let formData=new FormData($("#updateAvatar")[0]);userAPI.updateAvatar(formData).then(res=>{0==res.code&&(localStorage.setItem("imageURL",res.data),updateSlider(res.data)),store.isShowLoading(!1),showPopupSuccess()}).catch(e=>{console.log(e)})}else Promise.all([userAPI.updateAvatar(formData),userAPI.updateInfo(updateInfo)]).then(res=>{console.log(res)}).catch(e=>{console.log(e)});else 0!==Object.keys(updateInfo).length&&userAPI.updateInfo(updateInfo).then(res=>{0==res.code&&updateInfoLocal(updateInfo),console.log(res),store.isShowLoading(!1),showPopupSuccess()}).catch(e=>{console.log(e)})});let updateInfoLocal=infoLocal=>{infoLocal.name=infoLocal.display_name,delete infoLocal.display_name,Object.keys(infoLocal).forEach(e=>{window.localStorage.setItem(e,infoLocal[e])}),$("com-slider .information-user p")[0].innerHTML=window.localStorage.getItem("name")};this.afterBinding=(()=>{$("#myInputFile").change(e=>{let selectedFile=e.target.files[0],imgTag=document.getElementById("avatar"),reader=new FileReader;console.log(e),reader.onload=function(event){imgTag.src=event.target.result},reader.readAsDataURL(selectedFile),isChangeImage=!0}),$(".img-edit").on("click",e=>{let parent=e.currentTarget.parentNode,value=parent.querySelector("span").innerHTML;parent.querySelector("input").value=value,parent.classList.add("isEdit")}),$(".icon-check").on("click",e=>{let parent=e.currentTarget.parentNode;parent.classList.remove("isEdit");let inputUpdate=parent.querySelector("input");parent.querySelector("span").innerHTML=inputUpdate.value;let fieldUpdate=inputUpdate.getAttribute("name");updateInfo[fieldUpdate]=inputUpdate.value})}),this.removePopupSuccess=(()=>{store.isShowBlank(!1),$("#popup-success").removeClass("active")});let showPopupSuccess=()=>{$("#popup-success").addClass("active"),store.isShowBlank(!0)},updateSlider=src=>{$("com-slider img")[0].src=src}},template:'\n            <div id="my-profile">\n    <com-slider></com-slider>\n    <com-headercontext></com-headercontext>\n    <div class="popup success" id="popup-success">\n        <div>Cập nhật thành công</div>\n        <button class="btn-submit" style="padding: 7px 22px;" data-bind="event: {tap: removePopupSuccess}">OK</button>\n    </div>\n    <div class="body-content">\n        <div class="profile">\n            <form class="image-wrapper" id="updateAvatar">\n                <label class="image-circle" for="myInputFile">\n                    <img data-bind="attr: {src: avatar}" id="avatar">\n                    <input type="file" name="avatar" id="myInputFile" style="display:none;" />\n                </label>\n            </form>\n            <div class="name notEdit">\n                <span data-bind="text: name"></span>\n                <input type="text" class="input-edit" name="display_name">\n                <img src="./img/edit.svg" class="img-edit big">\n                <i class="fa fa-check icon-check" aria-hidden="true"></i>\n            </div>\n            <div class="profile-detail">\n                <div class="row notEdit">\n                    <i class="fa fa-map-marker" aria-hidden="true"></i>\n                    <span style="padding-left: 10px;" data-bind="text: location"></span>\n                    <input type="text" class="input-edit" name="address">\n                    <img src="./img/edit.svg" class="img-edit">\n                    <i class="fa fa-check icon-check"  aria-hidden="true"></i>\n                </div>\n                <div class="row notEdit">\n                    <i class="fa fa-phone " aria-hidden="true"></i>\n                    <span style="padding-left: 10px;" data-bind="text: phone"></span>\n                    <input type="text" class="input-edit"  name="phone">\n                    <img src="./img/edit.svg" class="img-edit">\n                    <i class="fa fa-check icon-check"  aria-hidden="true"></i>\n\n                </div>\n                <div class="row notEdit">\n                    <i class="fa fa-envelope" aria-hidden="true"></i>\n                    <span style="padding-left: 10px;" data-bind="text: email"></span>\n                    <input type="text" class="input-edit" name="email">\n                    <img src="./img/edit.svg" class="img-edit">\n                    <i class="fa fa-check icon-check"  aria-hidden="true"></i>\n\n                </div>\n                <div class="row notEdit">\n                    <i class="fa fa-calendar" aria-hidden="true"></i>\n                    <span style="padding-left: 10px;" data-bind="text: dateJoin"></span>\n                </div>\n            </div>\n        </div>\n        <div class="btn-wrapper">\n            <button class="btn-submit" data-bind="event: {tap: update}">Cập nhật</button>\n        </div>\n    </div>\n</div>\n        '}));